# vim: ft=sh
OS=`uname`

# Easy timezones for places I care about
alias lisbon='TZ="Europe/Lisbon" date'
alias nyc='TZ="America/New_York" date'
alias sf='TZ="America/Los_Angeles" date'
alias rio='TZ="America/Sao_Paulo" date'
alias tokyo='TZ="Asia/Tokyo" date'
alias utc='TZ="UTC" date'

# Get readable list of network IPs
alias ips="ifconfig -a | perl -nle'/(\d+\.\d+\.\d+\.\d+)/ && print $1'"
alias myip="dig +short myip.opendns.com @resolver1.opendns.com"
alias mygeo="curl -w \"\\n\" http://api.hackertarget.com/geoip/\?q=\`myip\`"

# Flush DNS cache
alias dnsflush="dscacheutil -flushcache"

# JSON Viewing view python
alias json='python -mjson.tool'

# Colorized cat (nyan)
if command -v pygmentize > /dev/null; then
  alias nyan='pygmentize -O style=emacs -f console256 -g'
fi

# Confirm file overwrite
alias mv='mv -i'

# CD into root of git project
alias pcd="cd \$(git rev-parse --show-toplevel 2>/dev/null || echo '.')"

if command -v fzf > /dev/null; then
  # CD into a directory within the project, selecting via fzf
  alias cdp="cd \$(git ls-files \$(git rev-parse --show-toplevel) | xargs -n1 dirname | sort | uniq | fzf || echo '.')"

  if command -v lpass > /dev/null; then
    # Fuzzy find to show/edit lastpass entry
    alias lshow="lpass show \$(lpass ls | fzf | awk '{print \$(NF)}' | sed 's/\]//g')"
    alias ledit="lpass edit \$(lpass ls | fzf | awk '{print \$(NF)}' | sed 's/\]//g')"
    # Backup LastPass database, sadly there is no import in command line tool
    alias lbackup="lpass export | gpg --symmetric > lpass-backup.gpg"
  fi

  # Fuzzy find for killing processes
  alias fkill="kill \$(ps afx | fzf | cut -f1 -d' ')"
fi

# Add current project NPM to path
if command -v npm > /dev/null; then
  alias npath='export PATH=$(npm bin):$PATH'
fi

# Autossh as a way to keep ports open
alias autossh-forward="autossh -M 0 -f -T -N"

# Map ls to be colorful
if [ $OS = "Darwin" ]; then
  alias ls='ls -GpFh'
  alias la='ls -AGpFh'
else
  alias ls='ls --color=auto -GpFh'
  alias la='ls --color=auto -AGpFh'
fi

# Shortcuts for copying from tmux clipboard to system clipboard
if command -v pbcopy > /dev/null; then
  alias tcopy='tmux save-buffer - | pbcopy'
elif command -v xclip > /dev/null; then
  alias tcopy='tmux save-buffer - | xclip -i -sel clipboard'
fi

# Load platform files if present
if [[ $OS == "Darwin" ]]; then
  if [ -f $HOME/.aliases.osx ]; then
    . $HOME/.aliases.osx
  fi
elif [[ $OS == "Linux" ]]; then
  if [ -f $HOME/.aliases.linux ]; then
    . $HOME/.aliases.linux
  fi
fi

# Load local file if present
if [ -f ~/.aliases.local ]; then
  . ~/.aliases.local
fi
